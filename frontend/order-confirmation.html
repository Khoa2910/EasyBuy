<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xác nhận đơn hàng - EasyBuy</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="assets/css/style.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container">
            <a class="navbar-brand fw-bold" href="index.html">
                <i class="fas fa-home me-2"></i>EasyBuy
            </a>
        </div>
    </nav>

    <!-- Confirmation Section -->
    <section class="py-5" style="margin-top: 100px;">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="text-center mb-5">
                        <i class="fas fa-check-circle fa-4x text-success mb-3"></i>
                        <h2 class="text-success">Đặt hàng thành công!</h2>
                        <p class="text-muted">Đơn hàng của bạn <span class="fw-semibold">đang chờ shop xác nhận</span>. Cảm ơn bạn đã mua sắm tại EasyBuy.</p>
                    </div>

                    <!-- Order Details -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-receipt me-2"></i>Thông tin đơn hàng
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Mã đơn hàng:</strong> <span id="orderId">#12345</span></p>
                                    <p><strong>Ngày đặt:</strong> <span id="orderDate">2024-01-01</span></p>
                                    <p><strong>Trạng thái:</strong> <span class="badge bg-warning" id="orderStatus">Đang chờ shop xác nhận</span></p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Phương thức thanh toán:</strong> <span id="paymentMethod">COD</span></p>
                                    <p><strong>Tổng tiền:</strong> <span class="text-primary fw-bold" id="orderTotal">0 ₫</span></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Shipping Address -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-map-marker-alt me-2"></i>Địa chỉ nhận hàng
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="shippingAddress">
                                <!-- Address will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Order Items -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-shopping-bag me-2"></i>Sản phẩm đã đặt
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="orderItems">
                                <!-- Order items will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Next Steps -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-info-circle me-2"></i>Bước tiếp theo
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4 text-center mb-3">
                                    <i class="fas fa-clock fa-2x text-primary mb-2"></i>
                                    <h6>Xác nhận đơn hàng</h6>
                                    <small class="text-muted">Chúng tôi sẽ xác nhận đơn hàng trong vòng 24h</small>
                                </div>
                                <div class="col-md-4 text-center mb-3">
                                    <i class="fas fa-truck fa-2x text-info mb-2"></i>
                                    <h6>Vận chuyển</h6>
                                    <small class="text-muted">Đơn hàng sẽ được giao trong 2-3 ngày</small>
                                </div>
                                <div class="col-md-4 text-center mb-3">
                                    <i class="fas fa-home fa-2x text-success mb-2"></i>
                                    <h6>Nhận hàng</h6>
                                    <small class="text-muted">Thanh toán khi nhận hàng</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="text-center">
                        <a href="orders.html" class="btn btn-primary me-3">
                            <i class="fas fa-list me-2"></i>Xem đơn hàng
                        </a>
                        <a href="products.html" class="btn btn-outline-primary">
                            <i class="fas fa-shopping-cart me-2"></i>Tiếp tục mua sắm
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-dark text-white py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mb-4">
                    <h5 class="fw-bold mb-3">EasyBuy</h5>
                    <p class="text-muted">Cửa hàng đồ gia dụng trực tuyến uy tín, cung cấp các sản phẩm chất lượng cao với giá cả hợp lý.</p>
                </div>
                <div class="col-lg-2 mb-4">
                    <h6 class="fw-bold mb-3">Sản phẩm</h6>
                    <ul class="list-unstyled">
                        <li><a href="products.html?category=1" class="text-muted text-decoration-none">Đồ dùng nhà bếp</a></li>
                        <li><a href="products.html?category=2" class="text-muted text-decoration-none">Trang trí nội thất</a></li>
                        <li><a href="products.html?category=3" class="text-muted text-decoration-none">Đồ dùng làm sạch</a></li>
                        <li><a href="products.html?category=4" class="text-muted text-decoration-none">Đồ điện gia dụng</a></li>
                    </ul>
                </div>
                <div class="col-lg-2 mb-4">
                    <h6 class="fw-bold mb-3">Hỗ trợ</h6>
                    <ul class="list-unstyled">
                        <li><a href="help.html" class="text-muted text-decoration-none">Trung tâm trợ giúp</a></li>
                        <li><a href="shipping.html" class="text-muted text-decoration-none">Vận chuyển</a></li>
                        <li><a href="returns.html" class="text-muted text-decoration-none">Đổi trả</a></li>
                        <li><a href="contact.html" class="text-muted text-decoration-none">Liên hệ</a></li>
                    </ul>
                </div>
                <div class="col-lg-2 mb-4">
                    <h6 class="fw-bold mb-3">Tài khoản</h6>
                    <ul class="list-unstyled">
                        <li><a href="login.html" class="text-muted text-decoration-none">Đăng nhập</a></li>
                        <li><a href="register.html" class="text-muted text-decoration-none">Đăng ký</a></li>
                        <li><a href="profile.html" class="text-muted text-decoration-none">Hồ sơ</a></li>
                        <li><a href="orders.html" class="text-muted text-decoration-none">Đơn hàng</a></li>
                    </ul>
                </div>
                <div class="col-lg-2 mb-4">
                    <h6 class="fw-bold mb-3">Liên hệ</h6>
                    <ul class="list-unstyled text-muted">
                        <li><i class="fas fa-phone me-2"></i> 1900 1234</li>
                        <li><i class="fas fa-envelope me-2"></i> info@tmdt.com</li>
                        <li><i class="fas fa-map-marker-alt me-2"></i> Hà Nội, Việt Nam</li>
                    </ul>
                </div>
            </div>
            <hr class="my-4">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="mb-0 text-muted">&copy; 2024 EasyBuy. Tất cả quyền được bảo lưu.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <a href="privacy.html" class="text-muted text-decoration-none me-3">Chính sách bảo mật</a>
                    <a href="terms.html" class="text-muted text-decoration-none">Điều khoản sử dụng</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="assets/js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            const urlParams = new URLSearchParams(window.location.search);
            const orderId = urlParams.get('orderId');

            if (orderId) {
                document.getElementById('orderId').textContent = '#' + orderId;
            }

            // Load order detail from API
            try {
                const token = localStorage.getItem('accessToken');
                const res = await fetch(`/api/orders/${orderId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                if (res.ok) {
                    const data = await res.json();
                    const o = data.order;

                    // Date
                    const createdAt = o.created_at ? new Date(o.created_at) : new Date();
                    document.getElementById('orderDate').textContent = createdAt.toLocaleDateString('vi-VN');

                    // Status and payment
                    document.getElementById('orderStatus').textContent = 'Đang chờ shop xác nhận';
                    document.getElementById('paymentMethod').textContent = (o.payment_method || 'COD').toUpperCase();
                    document.getElementById('orderTotal').textContent = new Intl.NumberFormat('vi-VN', {style:'currency', currency:'VND'}).format(o.total_amount || 0);

                    // Shipping address
                    const sa = o.shipping_address || {};
                    document.getElementById('shippingAddress').innerHTML = `
                        <p class="mb-1"><strong>${sa.recipientName || ''}</strong> - ${sa.phone || ''}</p>
                        <p class="mb-0 text-muted">${[sa.addressLine1, sa.addressLine2].filter(Boolean).join(', ')}</p>
                        <small class="text-muted">${[sa.ward, sa.state, sa.city, sa.postalCode, sa.country].filter(Boolean).join(', ')}</small>
                    `;

                    // Items
                    const itemsHtml = (o.items || []).map(item => `
                        <div class="d-flex justify-content-between border-bottom py-2">
                            <div class="d-flex align-items-center">
                                <img src="${item.image_url || 'assets/images/placeholder.jpg'}" class="rounded me-3" style="width:56px;height:56px;object-fit:cover;" alt="${item.product_name}" onerror="this.src='assets/images/placeholder.jpg'">
                                <div>
                                    <div class="fw-semibold">${item.product_name}</div>
                                    <small class="text-muted">SKU: ${item.product_sku || ''}</small>
                                </div>
                            </div>
                            <div class="text-end">
                                <div>${item.quantity} x ${new Intl.NumberFormat('vi-VN',{style:'currency',currency:'VND'}).format(item.unit_price)}</div>
                                <div class="fw-bold text-primary">${new Intl.NumberFormat('vi-VN',{style:'currency',currency:'VND'}).format(item.total_price)}</div>
                            </div>
                        </div>
                    `).join('');
                    document.getElementById('orderItems').innerHTML = itemsHtml || '<p class="text-muted mb-0">Không có sản phẩm.</p>';
                } else {
                    // Fallback date
                    const now = new Date();
                    document.getElementById('orderDate').textContent = now.toLocaleDateString('vi-VN');
                }
            } catch (err) {
                const now = new Date();
                document.getElementById('orderDate').textContent = now.toLocaleDateString('vi-VN');
            }
        });
    </script>
</body>
</html>



